# COMMIT フェーズ

# ユーザの入力
#$ARGUMENTS

## 目的
ドラフトの最終化、適切な保存場所への配置、**無料ツール（Git 等）**のみで Git 操作を自動化/半自動化する。

## 注意事項
- 常に ultrathink で段階的に思考すること
- ファイル名と保存場所の適切な選択（上書き防止を最優先）
- Git 操作前の確認プロセス（差分/ブランチ/ステージ状態）を徹底
- 既存ファイルの保護（重複時は連番付与）

## 必要な入力ファイル
- ドラフト（`drafts/draft_{TIMESTAMP}.md`）
- 品質チェック（`drafts/quality_check_{TIMESTAMP}.md`）

## タスクに含まれるべき TODO
1. ドラフト読込み・最終確認（YAML/本文/引用）
2. YAML フロントマター検証・補正（permalink/title/tags 等）
3. **ファイル名の自動生成**（記事タイプとタイトルから）
4. **保存ディレクトリ自動判定**（`news/` / `articles/` / `memo/`）
5. 既存ファイルの**重複チェック**（存在すれば `_2/_3...` を付与）
6. 最終ファイルの保存（ターゲット配下）
7. バックアップの作成（`drafts/backup/`）
8. `git add` 実行（対象ファイルのみ）
9. **コミットメッセージの自動生成**（規定書式）
10. `git commit` 実行（現在ブランチにコミット）
11. 付随スクリプト実行（必要に応じて）
12. 完了通知と出力情報の記録（パス/ハッシュ）

## 引数仕様
- **draft** (必須): ドラフトファイルパス
- **directory** (オプション): 保存先 (`auto`/`news`/`articles`/`memo`) デフォルト: `auto`
- **filename** (オプション): 生成ファイル名（拡張子なし） デフォルト: 自動生成
- **message** (オプション): コミットメッセージ デフォルト: 自動生成
- **mode** (オプション): 公開モード (`immediate`/`draft`) デフォルト: `immediate`

## 出力ディレクトリ判定ルール
- `news/`: `#ai-news` タグが **ある** 記事
- `articles/`: 詳細な技術/解説記事
- `memo/`: 短いメモ・備忘録

## ファイル名生成ルール
````text
[YYYY-MM-DD]_[記事タイトルの要約].md
例: 2025-08-24_OpenAI新モデル発表.md
````

## コミットメッセージ形式
````
[記事タイプ] [記事タイトルの要約]を追加

- 記事ID: [permalink]
- タグ: [タグリスト]
- 文字数: [数値]
````

## 最終確認項目
1. **ファイル内容確認**
   - YAMLフロントマターの完全性
   - 本文の最終チェック
   - 引用元の確認

2. **保存場所確認**
   - 適切なディレクトリ選択
   - ファイル名の妥当性
   - 重複の回避

3. **Git操作確認**
   - ステージング状態
   - コミットメッセージ
   - ブランチ状態

## エラー処理
- **ファイル重複時**: 連番を付けて保存（_2, _3...）
- **Git操作失敗時**: エラー内容を表示し、手動対応を促す
- **権限エラー時**: 適切なエラーメッセージと対処法を表示

## 最終出力形式
### 正常完了の場合
````
status: SUCCESS
next: COMPLETE
details: "記事を[保存先]/[ファイル名]に保存。Gitコミット完了。記事ID: [permalink]"
files:
  - saved: [保存先フルパス]
  - backup: [バックアップパス]
  - commit: [コミットハッシュ]
````

### エラー発生の場合
````
status: ERROR
next: MANUAL
details: "[エラー内容]。手動での対応が必要です。"
error_type: [FILE_EXISTS/GIT_ERROR/PERMISSION_ERROR]
suggestion: "[対処法の提案]"
````